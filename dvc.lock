schema: '2.0'
stages:
  prepare:
    cmd: python3 src/prepare.py
    deps:
    - path: data/mnist/raw
      md5: b6c29e96813679dd8c451c9b5ca86e2c.dir
      size: 11594722
      nfiles: 4
    - path: src/prepare.py
      md5: dda007b7d72ac1964ce279cba9d41778
      size: 3825
    params:
      params.yaml:
        prepare.remix: false
        prepare.remix_split: 0.2
        prepare.seed: 20210428
    outs:
    - path: data/mnist/prepared
      md5: cd35e4ee1528a9e57daf4f7affdb7fe6.dir
      size: 54951020
      nfiles: 2
  preprocess:
    cmd: python3 src/preprocess.py
    deps:
    - path: data/mnist/prepared/
      md5: cd35e4ee1528a9e57daf4f7affdb7fe6.dir
      size: 54951020
      nfiles: 2
    - path: src/preprocess.py
      md5: 35d98464ddade41429cdd09fc1588641
      size: 2323
    params:
      params.yaml:
        preprocess.add_noise: false
        preprocess.noise_amount: 0.0004
        preprocess.noise_s_vs_p: 0.5
        preprocess.normalize: true
        preprocess.seed: 20210428
        preprocess.shuffle: false
    outs:
    - path: data/mnist/preprocessed/
      md5: 6b4943a36fba46ed1183f2c1970e7f5f.dir
      size: 441841020
      nfiles: 2
  train:
    cmd: python3 src/train.py
    deps:
    - path: data/mnist/preprocessed/
      md5: 6b4943a36fba46ed1183f2c1970e7f5f.dir
      size: 441841020
      nfiles: 2
    - path: src/models.py
      md5: edfd5004a83c4566f5e237f84df856c2
      size: 3179
    - path: src/train.py
      md5: 63f4baf58e0cf3f7dfc8d0168e063ac4
      size: 1881
    params:
      params.yaml:
        model.cnn.conv_kernel_size: 3
        model.cnn.conv_units: 32
        model.cnn.dense_units: 128
        model.cnn.dropout: 0.5
        model.mlp.activation: relu
        model.mlp.units: 16
        model.name: mlp
        model.optimizer: Adam
        train.batch_size: 128
        train.epochs: 10
        train.seed: 20210428
        train.validation_split: 0.2
    outs:
    - path: logs.csv
      md5: dd4aa01ee6599a89dc9a16b66ea20e28
      size: 3394
    - path: models/mnist/model.h5
      md5: 763846d264b1c33f038ad7a93f5bd510
      size: 189856
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: models/mnist/model.h5
      md5: 763846d264b1c33f038ad7a93f5bd510
      size: 189856
    - path: src/evaluate.py
      md5: 094358ca814e8c20744720f918ea99b3
      size: 659
    outs:
    - path: metrics.json
      md5: c2303b7574b9dc2bfefc17f47b453fe2
      size: 292
